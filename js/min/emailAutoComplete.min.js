function EmailAutoComplete(a){this.config={targetCls:".inputElem",parentCls:".parentCls",hiddenCls:".hiddenCls",searchForm:".jqtransformdone",hoverBg:"hoverBg",inputValColor:"red",mailArr:"@qq.com @dragonsoftbravo.com @gmail.com @126.com @163.com @hotmail.com @yahoo.com @yahoo.com.cn @live.com @sohu.com @sina.com".split(" "),isSelectHide:!0,callback:null};this.cache={onlyFlag:!0,currentIndex:-1,oldIndex:-1};this.init(a)}
EmailAutoComplete.prototype={constructor:EmailAutoComplete,init:function(a){this.config=$.extend(this.config,a||{});var c=this,d=c.config,b=c.cache;$(d.targetCls).each(function(a,f){$(f).keyup(function(a){var e=a.target,h=$.trim($(this).val()),m=a.keyCode,n=$(this).outerHeight(),p=$(this).outerWidth(),g=$(this).closest(d.parentCls);$(g).css({position:"relative"});""==h?($(f).attr({"data-html":""}),$(d.hiddenCls,g).val(""),b.currentIndex=-1,b.oldIndex=-1,$(".auto-tip",g)&&!$(".auto-tip",g).hasClass("hidden")&&
$(".auto-tip",g).addClass("hidden"),c._removeBg(g)):($(f).attr({"data-html":h}),$(d.hiddenCls,g).val(h),$(".auto-tip",g)&&$(".auto-tip",g).hasClass("hidden")&&$(".auto-tip",g).removeClass("hidden"),c._renderHTML({keycode:m,e:a,target:e,targetVal:h,height:n,width:p,parentNode:g}))})});$(d.searchForm).each(function(a,b){$(b).keydown(function(a){if(13==a.keyCode)return!1})});$(document).click(function(a){a.stopPropagation();a=a.target;var b=d.targetCls.replace(/^\./,"");$(a).hasClass(b)||$(".auto-tip")&&
$(".auto-tip").each(function(a,b){!$(b).hasClass("hidden")&&$(b).addClass("hidden")})})},_renderHTML:function(a){var c=this.config,d=this.cache,b=this._keyCode(a.keycode);$(".auto-tip",a.parentNode).hasClass("hidden")&&$(".auto-tip",a.parentNode).removeClass("hidden");if(-1<b)this._keyUpAndDown(a.targetVal,a.e,a.parentNode);else{var e=/@/.test(a.targetVal)?a.targetVal.replace(/@.*/,""):a.targetVal;if(d.onlyFlag){$(a.parentNode).append('\x3cinput type\x3d"hidden" class\x3d"hiddenCls"/\x3e');b='\x3cul class\x3d"auto-tip"\x3e';
for(var f=0;f<c.mailArr.length;f++)b+='\x3cli class\x3d"p-index'+f+'" style\x3d"padding: 0 12px;"\x3e\x3cspan class\x3d"output-num"\x3e\x3c/span\x3e\x3cem class\x3d"em" data-html\x3d"'+c.mailArr[f]+'"\x3e'+c.mailArr[f]+"\x3c/em\x3e\x3c/li\x3e";b+="\x3c/ul\x3e";d.onlyFlag=!1;$(a.parentNode).append(b);$(".auto-tip",a.parentNode).css({position:"absolute",top:a.height,width:a.width-2+"px",left:"15px",border:"1px solid #ccc","background-color":"#fff","z-index":1E4})}$(".auto-tip li",a.parentNode).each(function(a,
b){$(".output-num",b).html(e);!$(".output-num",b).hasClass(c.inputValColor)&&$(".output-num",b).addClass(c.inputValColor);a=$.trim($(".em",b).attr("data-html"));$(b).attr({"data-html":e+""+a})});this._accurateMate({target:a.target,parentNode:a.parentNode});this._itemHover(a.parentNode);this._executeClick(a.parentNode)}},_accurateMate:function(a){var c=this.config,d=this.cache,b=$.trim($(a.target,a.parentNode).attr("data-html")),e=[];if(/@/.test(b)){var f=b.replace(/@.*/,""),h=b.replace(/.*@/,"");
$.map(c.mailArr,function(a){(new RegExp(h)).test(a)&&e.push(a)});if(0<e.length){$(".auto-tip",a.parentNode).html("");$(".auto-tip",a.parentNode)&&$(".auto-tip",a.parentNode).hasClass("hidden")&&$(".auto-tip",a.parentNode).removeClass("hidden");b="";for(var k=0,l=e.length;k<l;k++)b+='\x3cli class\x3d"p-index'+k+'"\x3e\x3cspan class\x3d"output-num"\x3e\x3c/span\x3e\x3cem class\x3d"em" data-html\x3d"'+e[k]+'"\x3e'+e[k]+"\x3c/em\x3e\x3c/li\x3e";$(".auto-tip",a.parentNode).html(b);$(".auto-tip li",a.parentNode).each(function(a,
b){$(".output-num",b).html(f);!$(".output-num",b).hasClass(c.inputValColor)&&$(".output-num",b).addClass(c.inputValColor);a=$.trim($(".em",b).attr("data-html"));$(b).attr("data-html","");$(b).attr({"data-html":f+""+a})});d.currentIndex=-1;d.oldIndex=-1;$(".auto-tip .output-num",a.parentNode).html(f);this._itemHover(a.parentNode);this._executeClick(a.parentNode)}else $(".auto-tip",a.parentNode)&&!$(".auto-tip",a.parentNode).hasClass("hidden")&&$(".auto-tip",a.parentNode).addClass("hidden"),$(".auto-tip",
a.parentNode).html("")}},_itemHover:function(a){var c=this.config;$(".auto-tip li",a).hover(function(a,b){!$(this).hasClass(c.hoverBg)&&$(this).addClass(c.hoverBg)},function(){$(this).hasClass(c.hoverBg)&&$(this).removeClass(c.hoverBg)})},_removeBg:function(a){var c=this.config;$(".auto-tip li",a).each(function(a,b){$(b).hasClass(c.hoverBg)&&$(b).removeClass(c.hoverBg)})},_keyUpAndDown:function(a,c,d){var b=this.cache;a=this.config;if($(".auto-tip li",d)&&0<$(".auto-tip li").length){var e=$(".auto-tip li",
d).length;c=c.keyCode;b.oldIndex=b.currentIndex;38==c?(-1==b.currentIndex?b.currentIndex=e-1:(--b.currentIndex,0>b.currentIndex&&(b.currentIndex=e-1)),-1!==b.currentIndex&&(!$(".auto-tip .p-index"+b.currentIndex,d).hasClass(a.hoverBg)&&$(".auto-tip .p-index"+b.currentIndex,d).addClass(a.hoverBg).siblings().removeClass(a.hoverBg),b=$(".auto-tip .p-index"+b.currentIndex,d).attr("data-html"),$(a.targetCls,d).val(b),$(a.hiddenCls,d).val(b))):40==c?(b.currentIndex==e-1?b.currentIndex=0:(b.currentIndex++,
b.currentIndex>e-1&&(b.currentIndex=0)),-1!==b.currentIndex&&(!$(".auto-tip .p-index"+b.currentIndex,d).hasClass(a.hoverBg)&&$(".auto-tip .p-index"+b.currentIndex,d).addClass(a.hoverBg).siblings().removeClass(a.hoverBg),b=$(".auto-tip .p-index"+b.currentIndex,d).attr("data-html"),$(a.targetCls,d).val(b),$(a.hiddenCls,d).val(b))):13==c&&(c=$(".auto-tip .p-index"+b.oldIndex,d).attr("data-html"),$(a.targetCls,d).val(c),$(a.hiddenCls,d).val(c),a.isSelectHide&&!$(".auto-tip",d).hasClass("hidden")&&$(".auto-tip",
d).addClass("hidden"),a.callback&&$.isFunction(a.callback)&&a.callback(),b.currentIndex=-1,b.oldIndex=-1)}},_keyCode:function(a){for(var c="17 18 38 40 37 39 33 34 35 46 36 13 45 44 145 19 20 9".split(" "),d=0,b=c.length;d<b;d++)if(a==c[d])return d;return-1},_executeClick:function(a){var c=this.config;$(".auto-tip li",a).unbind("click");$(".auto-tip li",a).bind("click",function(d){d=$(this).attr("data-html");$(c.targetCls,a).val(d);c.isSelectHide&&!$(".auto-tip",a).hasClass("hidden")&&$(".auto-tip",
a).addClass("hidden");$(c.hiddenCls,a).val(d);c.callback&&$.isFunction(c.callback)&&c.callback()})}};$(function(){new EmailAutoComplete({})});